<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Nota Promissória</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .hidden-print, .no-print {
                display: none !important;
            }
            .nota-promissoria {
                page-break-after: always;
                margin-bottom: 20px;
                box-shadow: none !important;
                border: none !important;
            }
            .nota-promissoria:last-child {
                page-break-after: auto;
            }
            body {
                background: white !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 transition-colors duration-300">
    <div class="min-h-screen py-8 px-4">
        <!-- Header -->
        <div class="max-w-4xl mx-auto mb-8 no-print">
            <h1 class="text-3xl font-bold text-center text-gray-800 dark:text-white mb-2">
                Gerador de Nota Promissória
            </h1>
            <p class="text-center text-gray-600 dark:text-gray-400">
                Crie notas promissórias de forma rápida e profissional
            </p>
        </div>

        <!-- Formulário -->
        <div class="max-w-4xl mx-auto mb-8 no-print">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Dados do Emitente -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Dados do Emitente</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Nome do Emitente
                            </label>
                            <input type="text" id="nomeEmitente" 
                                class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                CPF/CNPJ do Emitente
                            </label>
                            <input type="text" id="cpfEmitente" 
                                class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Endereço do Emitente
                            </label>
                            <textarea id="enderecoEmitente" rows="3"
                                class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent"></textarea>
                        </div>
                    </div>

                    <!-- Dados do Credor -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Dados do Credor</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Nome do Credor
                            </label>
                            <input type="text" id="nomeCredor" 
                                class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                CPF/CNPJ do Credor
                            </label>
                            <input type="text" id="cpfCredor" 
                                class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Cidade
                                </label>
                                <input type="text" id="cidade" 
                                    class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Data
                                </label>
                                <input type="date" id="dataEmissao" 
                                    class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dados Financeiros -->
                <div class="mt-6 space-y-4">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Dados Financeiros</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Valor (R$)
                            </label>
                            <input type="number" id="valor" step="0.01" min="0"
                                class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Data de Vencimento
                            </label>
                            <input type="date" id="dataVencimento" 
                                class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Quantidade
                            </label>
                            <input type="number" id="quantidade" value="1" min="1" max="10"
                                class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary focus:border-transparent">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Valor por Extenso
                        </label>
                        <input type="text" id="valorExtenso" readonly
                            class="w-full px-3 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-600 text-gray-900 dark:text-white">
                    </div>
                </div>

                <!-- Botões -->
                <div class="mt-8 flex flex-wrap gap-4 justify-center">
                    <button onclick="limparCampos()" 
                        class="px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-colors duration-200">
                        Limpar Campos
                    </button>
                    <button onclick="gerarNotas()" 
                        class="px-6 py-3 bg-primary hover:bg-blue-600 text-white rounded-lg transition-colors duration-200">
                        Gerar Nota(s)
                    </button>
                    <button onclick="imprimirNotas()" 
                        class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200">
                        🖨️ Imprimir
                    </button>
                    <button onclick="baixarPDF()" 
                        class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors duration-200">
                        📄 Baixar PDF
                    </button>
                    
            </div>
        </div>

        <!-- Área de Preview/Impressão -->
        <div id="notasContainer" class="print-area"></div>
    </div>

    <script>
        // Configurar dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Definir data atual
        document.getElementById('dataEmissao').valueAsDate = new Date();

        // Função para converter número em extenso
        function numeroParaExtenso(numero) {
            if (numero === 0) return "zero reais";
            
            const unidades = ["", "um", "dois", "três", "quatro", "cinco", "seis", "sete", "oito", "nove"];
            const especiais = ["dez", "onze", "doze", "treze", "quatorze", "quinze", "dezesseis", "dezessete", "dezoito", "dezenove"];
            const dezenas = ["", "", "vinte", "trinta", "quarenta", "cinquenta", "sessenta", "setenta", "oitenta", "noventa"];
            const centenas = ["", "cento", "duzentos", "trezentos", "quatrocentos", "quinhentos", "seiscentos", "setecentos", "oitocentos", "novecentos"];

            function converterGrupo(num) {
                if (num === 0) return "";
                
                let resultado = "";
                const c = Math.floor(num / 100);
                const d = Math.floor((num % 100) / 10);
                const u = num % 10;

                if (c > 0) {
                    if (num === 100) {
                        resultado += "cem";
                    } else {
                        resultado += centenas[c];
                    }
                }

                if (d === 1 && u > 0) {
                    if (resultado) resultado += " e ";
                    resultado += especiais[u];
                } else {
                    if (d > 0) {
                        if (resultado) resultado += " e ";
                        resultado += dezenas[d];
                    }
                    if (u > 0) {
                        if (resultado) resultado += " e ";
                        resultado += unidades[u];
                    }
                }

                return resultado;
            }

            const partes = numero.toString().split('.');
            const reais = parseInt(partes[0]);
            const centavos = partes[1] ? parseInt(partes[1].padEnd(2, '0').substring(0, 2)) : 0;

            let resultado = "";

            if (reais > 0) {
                if (reais === 1) {
                    resultado += "um real";
                } else if (reais < 1000) {
                    resultado += converterGrupo(reais) + " reais";
                } else if (reais < 1000000) {
                    const milhares = Math.floor(reais / 1000);
                    const resto = reais % 1000;
                    
                    if (milhares === 1) {
                        resultado += "mil";
                    } else {
                        resultado += converterGrupo(milhares) + " mil";
                    }
                    
                    if (resto > 0) {
                        resultado += " e " + converterGrupo(resto);
                    }
                    resultado += " reais";
                } else {
                    const milhoes = Math.floor(reais / 1000000);
                    const resto = reais % 1000000;
                    
                    if (milhoes === 1) {
                        resultado += "um milhão";
                    } else {
                        resultado += converterGrupo(milhoes) + " milhões";
                    }
                    
                    if (resto > 0) {
                        if (resto < 1000) {
                            resultado += " e " + converterGrupo(resto);
                        } else {
                            const milhares = Math.floor(resto / 1000);
                            const unidades = resto % 1000;
                            
                            if (milhares > 0) {
                                resultado += " e " + converterGrupo(milhares) + " mil";
                                if (unidades > 0) {
                                    resultado += " e " + converterGrupo(unidades);
                                }
                            }
                        }
                    }
                    resultado += " reais";
                }
            }

            if (centavos > 0) {
                if (resultado) resultado += " e ";
                if (centavos === 1) {
                    resultado += "um centavo";
                } else {
                    resultado += converterGrupo(centavos) + " centavos";
                }
            }

            return resultado || "zero reais";
        }

        // Atualizar valor por extenso
        document.getElementById('valor').addEventListener('input', function() {
            const valor = parseFloat(this.value) || 0;
            document.getElementById('valorExtenso').value = numeroParaExtenso(valor);
        });

        function formatarData(data) {
            const date = new Date(data + 'T00:00:00');
            return date.toLocaleDateString('pt-BR');
        }

        function limparCampos() {
            document.getElementById('nomeEmitente').value = '';
            document.getElementById('cpfEmitente').value = '';
            document.getElementById('enderecoEmitente').value = '';
            document.getElementById('nomeCredor').value = '';
            document.getElementById('cpfCredor').value = '';
            document.getElementById('cidade').value = '';
            document.getElementById('dataEmissao').valueAsDate = new Date();
            document.getElementById('valor').value = '';
            document.getElementById('valorExtenso').value = '';
            document.getElementById('dataVencimento').value = '';
            document.getElementById('quantidade').value = '1';
            document.getElementById('notasContainer').innerHTML = '';
        }

        function gerarNotas() {
            const dados = {
                nomeEmitente: document.getElementById('nomeEmitente').value,
                cpfEmitente: document.getElementById('cpfEmitente').value,
                enderecoEmitente: document.getElementById('enderecoEmitente').value,
                nomeCredor: document.getElementById('nomeCredor').value,
                cpfCredor: document.getElementById('cpfCredor').value,
                cidade: document.getElementById('cidade').value,
                dataEmissao: document.getElementById('dataEmissao').value,
                valor: document.getElementById('valor').value,
                valorExtenso: document.getElementById('valorExtenso').value,
                dataVencimento: document.getElementById('dataVencimento').value,
                quantidade: parseInt(document.getElementById('quantidade').value) || 1
            };

            // Validação básica
            if (!dados.nomeEmitente || !dados.nomeCredor || !dados.valor || !dados.dataVencimento) {
                showAlert('Por favor, preencha todos os campos obrigatórios.');
                return;
            }

            let html = '';
            for (let i = 0; i < dados.quantidade; i++) {
                html += gerarNotaHTML(dados, i + 1);
            }

            document.getElementById('notasContainer').innerHTML = html;
        }

        function gerarNotaHTML(dados, numero) {
            const dataVencimento = new Date(dados.dataVencimento + 'T00:00:00');
            const dataEmissao = new Date(dados.dataEmissao + 'T00:00:00');
            
            const dia = dataVencimento.getDate();
            const mes = dataVencimento.getMonth() + 1;
            const ano = dataVencimento.getFullYear();
            
            const meses = ["janeiro", "fevereiro", "março", "abril", "maio", "junho", 
                          "julho", "agosto", "setembro", "outubro", "novembro", "dezembro"];
            const mesExtenso = meses[dataVencimento.getMonth()];
            
            const diasExtenso = ["", "um", "dois", "três", "quatro", "cinco", "seis", "sete", "oito", "nove", "dez",
                               "onze", "doze", "treze", "quatorze", "quinze", "dezesseis", "dezessete", "dezoito", "dezenove", "vinte",
                               "vinte e um", "vinte e dois", "vinte e três", "vinte e quatro", "vinte e cinco", "vinte e seis", 
                               "vinte e sete", "vinte e oito", "vinte e nove", "trinta", "trinta e um"];
            
            const diaExtenso = diasExtenso[dia] || dia.toString();
            
            return `
                <div class="nota-promissoria max-w-2xl mx-auto mb-8 bg-white p-6 shadow-lg border" style="width: 210mm; min-height: 148mm; font-family: Arial, sans-serif;">
                    <!-- Cabeçalho -->
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-xl font-bold text-black">NOTA PROMISSÓRIA</h2>
                            <span class="text-sm text-black">Nº ${numero} de ${dados.quantidade}</span>
                        </div>
                        <div class="text-right text-sm text-black">
                            <div class="mb-1"><strong>Vencimento:</strong> ${String(dia).padStart(2, '0')} de ${String(mes).padStart(2, '0')} de ${ano}</div>
                            <div><strong>Valor:</strong> R$ ${parseFloat(dados.valor).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                        </div>
                    </div>

                    <!-- Texto principal -->
                    <div class="mb-8 text-black text-sm leading-6">
                        <p class="text-justify">
                            No dia <strong>${diaExtenso}</strong> de <strong>${String(mes).padStart(2, '0')}</strong> de <strong>${ano}</strong> pagarei(emos) por esta única via de <strong>NOTA PROMISSÓRIA</strong> a <strong>${dados.nomeCredor.toUpperCase()}</strong> ${dados.cpfCredor ? `<strong>CPF nº ${dados.cpfCredor}</strong>` : ''} ou a sua ordem, a quantia de <strong>${dados.valorExtenso}</strong> em moeda corrente deste país.
                        </p>
                    </div>

                    <!-- Dados do emitente e local/data -->
                    <div class="flex justify-between items-start mb-12 text-black text-sm">
                        <div>
                            <div class="mb-1"><strong>Emitente:</strong> ${dados.nomeEmitente}</div>
                            ${dados.cpfEmitente ? `<div class="mb-1"><strong>CPF:</strong> ${dados.cpfEmitente}</div>` : ''}
                            ${dados.enderecoEmitente ? `<div><strong>Endereço:</strong> ${dados.enderecoEmitente}</div>` : ''}
                        </div>
                        <div class="text-right">
                            <div><strong>${dados.cidade || '_______'}</strong>, ${dataEmissao.getDate()} de ${mesExtenso} de ${dataEmissao.getFullYear()}</div>
                        </div>
                    </div>

                    <!-- Linha de assinatura -->
                    <div class="mt-16 pt-8">
                        <div class="text-center">
                            <div class="border-t border-black w-80 mx-auto mb-2"></div>
                            <p class="text-xs text-black">Assinatura do Emitente</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function salvarComoHTML() {
            const container = document.getElementById('notasContainer');
            if (!container.innerHTML) {
                showAlert('Gere as notas antes de salvar.');
                return;
            }

            // Obter dados para o nome do arquivo
            const quantidade = parseInt(document.getElementById('quantidade').value) || 1;
            const nomeCredor = document.getElementById('nomeCredor').value || 'NotaPromissoria';
            const dataAtual = new Date().toISOString().split('T')[0];
            
            const filename = `${nomeCredor.replace(/[^a-zA-Z0-9]/g, '_')}_${dataAtual}_${quantidade > 1 ? quantidade + '_notas' : '1_nota'}.html`;

            // CSS para o arquivo HTML
            const htmlStyles = `
                <style>
                    @page {
                        size: A4 landscape;
                        margin: 10mm;
                    }
                    body {
                        font-family: Arial, sans-serif;
                        margin: 0;
                        padding: 20px;
                        background: white;
                    }
                    .nota-promissoria {
                        page-break-after: always;
                        margin-bottom: 40px;
                        background: white;
                        border: 1px solid #ccc;
                        padding: 30px;
                        max-width: 800px;
                        margin-left: auto;
                        margin-right: auto;
                    }
                    .nota-promissoria:last-child {
                        page-break-after: auto;
                    }
                    .flex {
                        display: flex;
                    }
                    .justify-between {
                        justify-content: space-between;
                    }
                    .items-start {
                        align-items: flex-start;
                    }
                    .text-right {
                        text-align: right;
                    }
                    .text-center {
                        text-align: center;
                    }
                    .text-justify {
                        text-align: justify;
                    }
                    .font-bold {
                        font-weight: bold;
                    }
                    .text-xl {
                        font-size: 1.25rem;
                    }
                    .text-sm {
                        font-size: 0.875rem;
                    }
                    .text-xs {
                        font-size: 0.75rem;
                    }
                    .mb-1 {
                        margin-bottom: 0.25rem;
                    }
                    .mb-2 {
                        margin-bottom: 0.5rem;
                    }
                    .mb-6 {
                        margin-bottom: 1.5rem;
                    }
                    .mb-8 {
                        margin-bottom: 2rem;
                    }
                    .mb-12 {
                        margin-bottom: 3rem;
                    }
                    .mt-16 {
                        margin-top: 4rem;
                    }
                    .pt-8 {
                        padding-top: 2rem;
                    }
                    .leading-6 {
                        line-height: 1.5rem;
                    }
                    .border-t {
                        border-top: 1px solid black;
                    }
                    .w-80 {
                        width: 20rem;
                    }
                    .mx-auto {
                        margin-left: auto;
                        margin-right: auto;
                    }
                    .text-black {
                        color: black;
                    }
                    @media print {
                        body {
                            background: white !important;
                        }
                        .nota-promissoria {
                            box-shadow: none !important;
                            border: 1px solid #000 !important;
                        }
                    }
                </style>
            `;

            // Conteúdo HTML completo
            const htmlContent = `
                <!DOCTYPE html>
                <html lang="pt-BR">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Nota Promissória - ${nomeCredor}</title>
                    ${htmlStyles}
                </head>
                <body>
                    ${container.innerHTML}
                </body>
                </html>
            `;

            // Criar blob e download
            const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            // Criar link de download
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.style.display = 'none';
            
            // Adicionar ao DOM, clicar e remover
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            // Limpar URL objeto
            URL.revokeObjectURL(url);
            
            showAlert('Arquivo HTML salvo com sucesso! Você pode abrir o arquivo e usar Ctrl+P para imprimir ou salvar como PDF.');
        }

        function imprimirNotas() {
            const container = document.getElementById('notasContainer');
            if (!container.innerHTML) {
                showAlert('Gere as notas antes de imprimir.');
                return;
            }

            // Criar uma nova janela para impressão
            const printWindow = window.open('', '_blank');
            
            // CSS específico para impressão
            const printStyles = `
                <style>
                    @page {
                        size: A4 landscape;
                        margin: 10mm;
                    }
                    body {
                        font-family: Arial, sans-serif;
                        margin: 0;
                        padding: 0;
                        background: white;
                    }
                    .nota-promissoria {
                        page-break-after: always;
                        margin-bottom: 20px;
                        background: white;
                        border: 1px solid #ccc;
                        padding: 20mm;
                        width: 277mm;
                        min-height: 190mm;
                    }
                    .nota-promissoria:last-child {
                        page-break-after: auto;
                    }
                    .flex {
                        display: flex;
                    }
                    .justify-between {
                        justify-content: space-between;
                    }
                    .items-start {
                        align-items: flex-start;
                    }
                    .text-right {
                        text-align: right;
                    }
                    .text-center {
                        text-align: center;
                    }
                    .text-justify {
                        text-align: justify;
                    }
                    .font-bold {
                        font-weight: bold;
                    }
                    .text-xl {
                        font-size: 1.25rem;
                    }
                    .text-sm {
                        font-size: 0.875rem;
                    }
                    .text-xs {
                        font-size: 0.75rem;
                    }
                    .mb-1 {
                        margin-bottom: 0.25rem;
                    }
                    .mb-2 {
                        margin-bottom: 0.5rem;
                    }
                    .mb-6 {
                        margin-bottom: 1.5rem;
                    }
                    .mb-8 {
                        margin-bottom: 2rem;
                    }
                    .mb-12 {
                        margin-bottom: 3rem;
                    }
                    .mt-16 {
                        margin-top: 4rem;
                    }
                    .pt-8 {
                        padding-top: 2rem;
                    }
                    .leading-6 {
                        line-height: 1.5rem;
                    }
                    .border-t {
                        border-top: 1px solid black;
                    }
                    .w-80 {
                        width: 20rem;
                    }
                    .mx-auto {
                        margin-left: auto;
                        margin-right: auto;
                    }
                </style>
            `;

            // Conteúdo HTML para impressão
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Nota Promissória - Impressão</title>
                    ${printStyles}
                </head>
                <body>
                    ${container.innerHTML}
                </body>
                </html>
            `;

            // Escrever conteúdo na nova janela
            printWindow.document.write(printContent);
            printWindow.document.close();

            // Aguardar carregamento e imprimir
            printWindow.onload = function() {
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            };
        }

        async function baixarPDF() {
            const container = document.getElementById('notasContainer');
            if (!container.innerHTML) {
                showAlert('Gere as notas antes de baixar o PDF.');
                return;
            }

            // Mostrar loading
            const loadingModal = document.createElement('div');
            loadingModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            loadingModal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
                    <div class="flex items-center space-x-3">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
                        <p class="text-gray-700 dark:text-gray-300">Gerando PDF...</p>
                    </div>
                </div>
            `;
            document.body.appendChild(loadingModal);

            try {
                const quantidade = parseInt(document.getElementById('quantidade').value) || 1;
                const nomeCredor = document.getElementById('nomeCredor').value || 'NotaPromissoria';
                const dataAtual = new Date().toISOString().split('T')[0];
                
                const filename = `${nomeCredor.replace(/[^a-zA-Z0-9]/g, '_')}_${dataAtual}_${quantidade > 1 ? quantidade + '_notas' : '1_nota'}.pdf`;

                // Usar jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });

                const notas = container.querySelectorAll('.nota-promissoria');
                
                for (let i = 0; i < notas.length; i++) {
                    if (i > 0) {
                        pdf.addPage();
                    }
                    
                    // Converter HTML para canvas
                    const canvas = await html2canvas(notas[i], {
                        scale: 2,
                        useCORS: true,
                        allowTaint: true,
                        backgroundColor: '#ffffff'
                    });
                    
                    const imgData = canvas.toDataURL('image/png');
                    const imgWidth = 277; // A4 landscape width in mm
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    
                    pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);
                }

                pdf.save(filename);
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showAlert('Erro ao gerar PDF. Tente usar a opção "Salvar HTML" como alternativa.');
            } finally {
                // Remover loading
                loadingModal.remove();
            }
        }

        function showAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-primary text-white hover:bg-blue-600 rounded" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>
