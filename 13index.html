<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="./agr.png?v=2">
    <title>Bloco de Notas Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'bg-light': '#FFFFFF',
                        'bg-dark': '#181818'
                    }
                }
            }
        }
    </script>
    <style>
        .note-item:hover {
            background-color: rgba(93, 92, 222, 0.1);
        }
        .note-item.active {
            background-color: rgba(93, 92, 222, 0.2);
            border-left: 4px solid #5D5CDE;
        }
        .dark .note-item:hover {
            background-color: rgba(93, 92, 222, 0.2);
        }
        .dark .note-item.active {
            background-color: rgba(93, 92, 222, 0.3);
        }

        .bulk-mode .note-item {
            cursor: default;
        }
        .bulk-mode .note-item:hover {
            background-color: transparent;
        }
        .bulk-mode .note-item.active {
            background-color: transparent;
        }
        .bulk-mode .note-item .note-content {
            flex: 1;
        }

        @media (max-width: 768px) {
            .mobile-sidebar-hidden {
                transform: translateX(-100%);
            }
            .mobile-sidebar-visible {
                transform: translateX(0);
            }
            .mobile-overlay-visible {
                display: block;
            }
        }
    </style>
</head>
<body class="bg-bg-light dark:bg-bg-dark text-gray-900 dark:text-gray-100 font-sans">
    <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden"></div>

    <header class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-2 sm:px-4 py-3 sticky top-0 z-30">
        <div class="flex justify-between items-center">
            <div class="flex items-center gap-2">
                <button id="sidebarToggleBtn" class="p-2 rounded-lg md:hidden hover:bg-gray-200 dark:hover:bg-gray-700" title="Alternar barra lateral">
                    <svg class="w-6 h-6 text-gray-800 dark:text-gray-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                <h1 class="text-xl font-semibold text-gray-800 dark:text-gray-200">üìù Bloco de Notas</h1>
            </div>
            <div class="flex gap-2">
                <button id="exportBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 text-sm md:px-4 md:py-2 md:text-base rounded-lg flex items-center gap-2 transition-colors" title="Exportar notas">
                    <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    <span class="hidden sm:inline">Exportar</span>
                </button>
                <button id="shareBtn" class="bg-primary hover:bg-blue-600 text-white px-3 py-2 text-sm md:px-4 md:py-2 md:text-base rounded-lg flex items-center gap-2 transition-colors" title="Compartilhar notas">
                    <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 16a2 2 0 11-4 0 2 2 0 014 0zM6 16a2 2 0 11-4 0 2 2 0 014 0zM12 4a2 2 0 11-4 0 2 2 0 014 0zM4 14v-2.586a1 1 0 01.293-.707l6-6a1 1 0 011.414 0l6 6a1 1 0 01.293.707V14"></path>
                    </svg>
                    <span class="hidden sm:inline">Compartilhar</span>
                </button>
                <label for="importFile" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-2 text-sm md:px-4 md:py-2 md:text-base rounded-lg flex items-center gap-2 transition-colors cursor-pointer" title="Importar notas">
                    <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                    </svg>
                    <span class="hidden sm:inline">Importar</span>
                    <input type="file" id="importFile" accept=".json" class="hidden">
                </label>
                <button id="newNoteBtn" class="bg-primary hover:bg-blue-600 text-white px-3 py-2 text-sm md:px-4 md:py-2 md:text-base rounded-lg flex items-center gap-2 transition-colors" title="Nova Nota">
                    <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    <span class="hidden sm:inline">Nova Nota</span>
                </button>
            </div>
        </div>
    </header>

    <div class="flex h-screen overflow-hidden">
        <aside id="sidebar" class="w-80 bg-gray-50 dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 flex flex-col fixed inset-y-0 left-0 z-30 transition-transform duration-300 md:static md:flex mobile-sidebar-hidden">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <div>
                    <h2 class="font-medium text-gray-700 dark:text-gray-300">Suas Anota√ß√µes</h2>
                    <p id="notesCount" class="text-sm text-gray-500 dark:text-gray-400">0 anota√ß√µes</p>
                </div>
                <button id="bulkSelectBtn" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-3 py-1 rounded-full text-sm hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                    Selecionar
                </button>
            </div>

            <div id="bulkActionsBar" class="hidden p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between">
                <label class="inline-flex items-center space-x-2 cursor-pointer">
                    <input type="checkbox" id="selectAllCheckbox" class="form-checkbox h-4 w-4 text-primary rounded" />
                    <span class="text-sm">Selecionar Todas</span>
                </label>
                <button id="deleteSelectedBtn" class="bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-1 rounded transition-colors" disabled>
                    Excluir (<span id="selectedCount">0</span>)
                </button>
            </div>

            <div id="notesList" class="flex-1 overflow-y-auto">
                </div>
        </aside>

        <main class="flex-1 flex flex-col">
            <div id="editorHeader" class="sticky top-0 z-10 p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 shadow-sm hidden">
                <div class="flex justify-between items-center">
                    <input
                        type="text"
                        id="noteTitle"
                        placeholder="T√≠tulo da anota√ß√£o..."
                        class="text-lg font-medium bg-transparent border-none outline-none flex-1 text-gray-800 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400"
                        style="font-size: 18px;"
                    >
                    <div class="flex gap-1 sm:gap-2 relative">
                        <button id="alignmentMenuBtn" class="bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-2 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
                            <span class="text-lg">‚ãÆ</span>
                        </button>
                        <div id="alignmentMenu" class="absolute right-0 top-12 w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-20 hidden">
                            <ul class="py-2 text-sm text-gray-700 dark:text-gray-200">
                                <li>
                                    <button class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700" data-align="left">
                                        Alinhar √† esquerda
                                    </button>
                                </li>
                                <li>
                                    <button class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700" data-align="center">
                                        Centralizar
                                    </button>
                                </li>
                                <li>
                                    <button class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700" data-align="right">
                                        Alinhar √† direita
                                    </button>
                                </li>
                                <li>
                                    <button class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700" data-align="justify">
                                        Justificar
                                    </button>
                                </li>
                            </ul>
                        </div>
                        <button id="saveBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 text-sm rounded-lg flex items-center gap-2 transition-colors" title="Salvar">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4v4m-2-2h4m-4 2V9m4 0V5a2 2 0 00-2-2h-4a2 2 0 00-2 2v4"></path>
                            </svg>
                            <span class="hidden sm:inline">Salvar</span>
                        </button>
                        <button id="secureSaveBtn" class="bg-primary hover:bg-blue-600 text-white px-3 py-2 text-sm rounded-lg flex items-center gap-2 transition-colors" title="Salvar com Seguran√ßa">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6-4h12M9 11V9a3 3 0 016 0v2m2 5h-2a2 2 0 01-2-2v-2a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2z"></path>
                            </svg>
                            <span class="hidden sm:inline">Salvar com Seguran√ßa</span>
                        </button>
                        <button id="deleteBtn" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 text-sm rounded-lg flex items-center gap-2 transition-colors" title="Excluir">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1H9a1 1 0 00-1 1v3m.5-1.5h7"></path>
                            </svg>
                            <span class="hidden sm:inline">Excluir</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex-1 p-4 bg-white dark:bg-gray-800 hidden">
                <textarea
                    id="noteContent"
                    placeholder="Comece a escrever sua anota√ß√£o aqui..."
                    class="w-full h-full resize-none border-none outline-none bg-transparent text-gray-800 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 leading-relaxed text-left"
                    style="font-size: 16px; line-height: 1.6;"
                ></textarea>
            </div>

            <div id="emptyState" class="flex-1 flex items-center justify-center text-center p-8">
                <div>
                    <div class="text-6xl mb-4">üìù</div>
                    <h3 class="text-xl font-medium text-gray-600 dark:text-gray-400 mb-2">Nenhuma anota√ß√£o selecionada</h3>
                    <p class="text-gray-500 dark:text-gray-500 mb-6">Selecione uma anota√ß√£o da lista ou crie uma nova</p>
                    <button id="createFirstNoteBtn" class="bg-primary hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition-colors">
                        Criar primeira anota√ß√£o
                    </button>
                </div>
            </div>
        </main>
    </div>

    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full h-full sm:w-auto sm:h-auto sm:max-w-sm mx-4">
            <h3 id="confirmModalTitle" class="text-lg font-medium text-gray-800 dark:text-gray-200 mb-2">Confirmar exclus√£o</h3>
            <p id="confirmModalText" class="text-gray-600 dark:text-gray-400 mb-6">Tem certeza que deseja excluir esta anota√ß√£o? Esta a√ß√£o n√£o pode ser desfeita.</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelDelete" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                    Cancelar
                </button>
                <button id="confirmDelete" class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded transition-colors">
                    Excluir
                </button>
            </div>
        </div>
    </div>
    
    <div id="secureSaveModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full h-full sm:w-auto sm:h-auto sm:max-w-sm mx-4">
            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200 mb-2">Salvar com Seguran√ßa</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Digite uma senha para proteger esta anota√ß√£o. Voc√™ precisar√° dela para abri-la.</p>
            <div class="mb-4">
                <input type="password" id="secureSavePassword" placeholder="Digite a senha" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none outline-none focus:ring-2 focus:ring-primary">
            </div>
            <div class="flex items-center mb-4">
                <input type="checkbox" id="toggleSecureSavePassword" class="h-4 w-4 text-primary rounded border-gray-300 focus:ring-primary">
                <label for="toggleSecureSavePassword" class="ml-2 text-sm text-gray-600 dark:text-gray-400 cursor-pointer">Mostrar senha</label>
            </div>
            <p id="secureSaveError" class="text-red-500 text-sm mb-4 hidden">A senha n√£o pode estar vazia.</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelSecureSave" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                    Cancelar
                </button>
                <button id="confirmSecureSave" class="px-4 py-2 bg-primary text-white hover:bg-blue-600 rounded transition-colors">
                    Salvar
                </button>
            </div>
        </div>
    </div>

    <div id="secureOpenModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full h-full sm:w-auto sm:h-auto sm:max-w-sm mx-4">
            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200 mb-2">Abrir Anota√ß√£o Segura</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-4">Esta anota√ß√£o est√° protegida. Por favor, digite a senha para visualiz√°-la.</p>
            <div class="mb-4">
                <input type="password" id="secureOpenPassword" placeholder="Digite a senha" class="w-full px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 border-none outline-none focus:ring-2 focus:ring-primary">
            </div>
            <div class="flex items-center mb-4">
                <input type="checkbox" id="toggleSecureOpenPassword" class="h-4 w-4 text-primary rounded border-gray-300 focus:ring-primary">
                <label for="toggleSecureOpenPassword" class="ml-2 text-sm text-gray-600 dark:text-gray-400 cursor-pointer">Mostrar senha</label>
            </div>
            <p id="secureOpenError" class="text-red-500 text-sm mb-4 hidden">Senha incorreta. Tente novamente.</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelSecureOpen" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                    Cancelar
                </button>
                <button id="confirmSecureOpen" class="px-4 py-2 bg-primary text-white hover:bg-blue-600 rounded transition-colors">
                    Abrir
                </button>
            </div>
        </div>
    </div>
    
    <div id="exportSelectionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full h-full sm:w-auto sm:h-auto sm:max-w-lg mx-4">
            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200 mb-4">Escolha uma op√ß√£o de exporta√ß√£o</h3>
            
            <button id="exportAllBtn" class="w-full bg-primary hover:bg-blue-600 text-white font-medium py-3 rounded-lg mb-4 transition-colors">
                Exportar todas as anota√ß√µes
            </button>

            <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">Ou escolha uma anota√ß√£o individual:</p>
                <div id="exportNoteList" class="max-h-80 overflow-y-auto mb-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                    </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelExport" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                        Cancelar
                    </button>
                    <button id="confirmExport" class="px-4 py-2 bg-primary text-white hover:bg-blue-600 rounded transition-colors" disabled>
                        Exportar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="shareModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg w-full h-full sm:w-auto sm:h-auto sm:max-w-lg mx-4">
            <h3 class="text-lg font-medium text-gray-800 dark:text-gray-200 mb-4">Escolha uma op√ß√£o de compartilhamento</h3>
            
            <button id="shareAllBtn" class="w-full bg-primary hover:bg-blue-600 text-white font-medium py-3 rounded-lg mb-4 transition-colors">
                Compartilhar todas as anota√ß√µes
            </button>

            <div class="border-t border-gray-200 dark:border-gray-700 pt-4">
                <p class="text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">Ou escolha uma anota√ß√£o individual:</p>
                <div id="shareNoteList" class="max-h-80 overflow-y-auto mb-4 border border-gray-200 dark:border-gray-700 rounded-lg">
                    </div>
                <div class="flex justify-end space-x-3">
                    <button id="cancelShare" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors">
                        Cancelar
                    </button>
                    <button id="confirmShare" class="px-4 py-2 bg-primary text-white hover:bg-blue-600 rounded transition-colors" disabled>
                        Compartilhar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        class NotesApp {
            constructor() {
                this.notes = this.loadNotes();
                this.currentNoteId = null;
                this.currentSecurePassword = null; // New: temporarily stores password for secure notes
                this.isEditing = false;
                this.bulkMode = false;
                this.selectedNotes = new Set();
                this.pendingDeleteIds = null;

                this.initElements();
                this.bindEvents();
                this.render();
            }

            initElements() {
                this.notesList = document.getElementById('notesList');
                this.notesCount = document.getElementById('notesCount');
                this.noteTitle = document.getElementById('noteTitle');
                this.noteContent = document.getElementById('noteContent');
                this.emptyState = document.getElementById('emptyState');
                this.editorHeader = document.getElementById('editorHeader');
                this.newNoteBtn = document.getElementById('newNoteBtn');
                this.createFirstNoteBtn = document.getElementById('createFirstNoteBtn');
                this.saveBtn = document.getElementById('saveBtn');
                this.secureSaveBtn = document.getElementById('secureSaveBtn');
                this.deleteBtn = document.getElementById('deleteBtn');
                this.confirmModal = document.getElementById('confirmModal');
                this.confirmModalTitle = document.getElementById('confirmModalTitle');
                this.confirmModalText = document.getElementById('confirmModalText');
                this.cancelDelete = document.getElementById('cancelDelete');
                this.confirmDelete = document.getElementById('confirmDelete');
                
                // Secure Save elements
                this.secureSaveModal = document.getElementById('secureSaveModal');
                this.secureSavePassword = document.getElementById('secureSavePassword');
                this.toggleSecureSavePassword = document.getElementById('toggleSecureSavePassword');
                this.secureSaveError = document.getElementById('secureSaveError');
                this.cancelSecureSave = document.getElementById('cancelSecureSave');
                this.confirmSecureSave = document.getElementById('confirmSecureSave');

                // Secure Open elements
                this.secureOpenModal = document.getElementById('secureOpenModal');
                this.secureOpenPassword = document.getElementById('secureOpenPassword');
                this.toggleSecureOpenPassword = document.getElementById('toggleSecureOpenPassword');
                this.secureOpenError = document.getElementById('secureOpenError');
                this.cancelSecureOpen = document.getElementById('cancelSecureOpen');
                this.confirmSecureOpen = document.getElementById('confirmSecureOpen');
                
                // Bulk mode elements
                this.bulkSelectBtn = document.getElementById('bulkSelectBtn');
                this.bulkActionsBar = document.getElementById('bulkActionsBar');
                this.selectAllCheckbox = document.getElementById('selectAllCheckbox');
                this.deleteSelectedBtn = document.getElementById('deleteSelectedBtn');
                this.selectedCount = document.getElementById('selectedCount');
                
                // Import/Export elements
                this.exportBtn = document.getElementById('exportBtn');
                this.importFile = document.getElementById('importFile');
                this.exportSelectionModal = document.getElementById('exportSelectionModal');
                this.exportNoteList = document.getElementById('exportNoteList');
                this.cancelExport = document.getElementById('cancelExport');
                this.confirmExport = document.getElementById('confirmExport');
                this.exportAllBtn = document.getElementById('exportAllBtn');

                // Share elements
                this.shareBtn = document.getElementById('shareBtn');
                this.shareModal = document.getElementById('shareModal');
                this.shareNoteList = document.getElementById('shareNoteList');
                this.cancelShare = document.getElementById('cancelShare');
                this.confirmShare = document.getElementById('confirmShare');
                this.shareAllBtn = document.getElementById('shareAllBtn');

                // Mobile
                this.sidebar = document.getElementById('sidebar');
                this.sidebarToggleBtn = document.getElementById('sidebarToggleBtn');
                this.mobileOverlay = document.getElementById('mobileOverlay');

                // Alignment menu elements
                this.alignmentMenuBtn = document.getElementById('alignmentMenuBtn');
                this.alignmentMenu = document.getElementById('alignmentMenu');
                this.alignmentButtons = this.alignmentMenu.querySelectorAll('button');
            }

            bindEvents() {
                this.newNoteBtn.addEventListener('click', () => this.createNewNote());
                this.createFirstNoteBtn.addEventListener('click', () => this.createNewNote());
                this.saveBtn.addEventListener('click', () => this.saveCurrentNote());
                this.secureSaveBtn.addEventListener('click', () => this.showSecureSaveModal());
                this.deleteBtn.addEventListener('click', () => this.showDeleteConfirmation([this.currentNoteId]));
                this.cancelDelete.addEventListener('click', () => this.hideDeleteConfirmation());
                this.confirmDelete.addEventListener('click', () => this.deleteNotes());

                // Secure Save Modal events
                this.cancelSecureSave.addEventListener('click', () => this.secureSaveModal.classList.add('hidden'));
                this.confirmSecureSave.addEventListener('click', () => this.handleSecureSave());
                this.secureSavePassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleSecureSave();
                });
                this.toggleSecureSavePassword.addEventListener('change', (e) => this.togglePasswordVisibility(this.secureSavePassword, e.target.checked));

                // Secure Open Modal events
                this.cancelSecureOpen.addEventListener('click', () => {
                    this.secureOpenModal.classList.add('hidden');
                    this.hideEditor();
                });
                this.confirmSecureOpen.addEventListener('click', () => this.handleSecureOpen());
                this.secureOpenPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleSecureOpen();
                });
                this.toggleSecureOpenPassword.addEventListener('change', (e) => this.togglePasswordVisibility(this.secureOpenPassword, e.target.checked));

                // Bulk mode events
                this.bulkSelectBtn.addEventListener('click', () => this.toggleBulkMode());
                this.selectAllCheckbox.addEventListener('change', () => this.toggleSelectAll());
                this.deleteSelectedBtn.addEventListener('click', () => this.showDeleteConfirmation(Array.from(this.selectedNotes)));
                
                // Import/Export events
                this.exportBtn.addEventListener('click', () => this.handleExport());
                this.importFile.addEventListener('change', (e) => this.importNotes(e));
                this.exportSelectionModal.classList.add('hidden');
                this.confirmExport.addEventListener('click', () => this.exportSingleNoteFromModal());
                this.exportAllBtn.addEventListener('click', () => this.exportAllNotes());

                // Share events
                this.shareBtn.addEventListener('click', () => this.handleShare());
                this.cancelShare.addEventListener('click', () => this.shareModal.classList.add('hidden'));
                this.confirmShare.addEventListener('click', () => this.shareSingleNoteFromModal());
                this.shareAllBtn.addEventListener('click', () => this.shareAllNotes());

                // Mobile
                this.sidebarToggleBtn.addEventListener('click', () => this.toggleSidebar());
                this.mobileOverlay.addEventListener('click', () => this.toggleSidebar(false));

                // Auto-save on input
                this.noteTitle.addEventListener('input', () => this.markAsEditing());
                this.noteContent.addEventListener('input', () => this.markAsEditing());

                // Alignment menu events
                this.alignmentMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.alignmentMenu.classList.toggle('hidden');
                });
                this.alignmentButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                        this.setAlignment(e.target.dataset.align);
                    });
                });
                document.addEventListener('click', (e) => {
                    if (!this.alignmentMenu.contains(e.target) && !this.alignmentMenuBtn.contains(e.target)) {
                        this.alignmentMenu.classList.add('hidden');
                    }
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        if (e.key === 's') {
                            e.preventDefault();
                            this.saveCurrentNote();
                        }
                        if (e.key === 'n') {
                            e.preventDefault();
                            this.createNewNote();
                        }
                    }
                });
            }

            togglePasswordVisibility(inputElement, isChecked) {
                inputElement.setAttribute('type', isChecked ? 'text' : 'password');
            }

            toggleSidebar(show = null) {
                const isHidden = this.sidebar.classList.contains('mobile-sidebar-hidden');
                
                if (show === null) {
                    show = isHidden;
                }

                if (show) {
                    this.sidebar.classList.remove('mobile-sidebar-hidden');
                    this.sidebar.classList.add('mobile-sidebar-visible');
                    this.mobileOverlay.classList.remove('hidden');
                } else {
                    this.sidebar.classList.remove('mobile-sidebar-visible');
                    this.sidebar.classList.add('mobile-sidebar-hidden');
                    this.mobileOverlay.classList.add('hidden');
                }
            }

            loadNotes() {
                try {
                    const notes = JSON.parse(localStorage.getItem('notesApp'));
                    return notes && Array.isArray(notes) ? notes : [];
                } catch (e) {
                    console.error("Failed to load notes from localStorage", e);
                    return [];
                }
            }

            saveNotes() {
                localStorage.setItem('notesApp', JSON.stringify(this.notes));
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            createNewNote() {
                if (this.bulkMode) {
                    this.toggleBulkMode();
                }

                this.currentSecurePassword = null; // Clear password on new note
                const newNote = {
                    id: this.generateId(),
                    title: 'Nova anota√ß√£o',
                    content: '',
                    alignment: 'left',
                    isSecure: false,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                this.notes.unshift(newNote);
                this.saveNotes();
                this.selectNote(newNote.id);
                this.render();
                
                setTimeout(() => {
                    this.noteTitle.focus();
                    this.noteTitle.select();
                }, 100);
            }

            selectNote(noteId) {
                if (this.bulkMode) {
                    this.toggleNoteSelection(noteId);
                    return;
                }
                
                const note = this.notes.find(n => n.id === noteId);
                if (!note) return;

                this.currentNoteId = noteId;
                this.currentSecurePassword = null; // Clear password on note change

                if (note.isSecure) {
                    this.noteTitle.value = note.title;
                    this.noteContent.value = 'Esta nota est√° protegida. Digite a senha para visualiz√°-la.';
                    this.showEditor();
                    this.showSecureOpenModal();
                } else {
                    this.noteTitle.value = note.title;
                    this.noteContent.value = note.content;
                    this.showEditor();
                }
                
                this.isEditing = false;
                this.setAlignment(note.alignment || 'left', false);
                this.updateActiveNote();

                if (window.innerWidth < 768) {
                    this.toggleSidebar(false);
                }
            }

            showSecureSaveModal() {
                this.secureSavePassword.value = '';
                this.toggleSecureSavePassword.checked = false;
                this.secureSavePassword.type = 'password';
                this.secureSaveError.classList.add('hidden');
                this.secureSaveModal.classList.remove('hidden');
                this.secureSavePassword.focus();
            }

            handleSecureSave() {
                const password = this.secureSavePassword.value;
                if (!password) {
                    this.secureSaveError.classList.remove('hidden');
                    return;
                }

                const note = this.notes.find(n => n.id === this.currentNoteId);
                if (!note) return;

                const content = this.noteContent.value;
                const encryptedContent = this.encryptNoteContent(content, password);
                
                note.content = encryptedContent;
                note.isSecure = true;
                note.updatedAt = new Date().toISOString();
                
                this.saveNotes();
                this.secureSaveModal.classList.add('hidden');
                this.showSaveIndicator();
                this.render();
                
                this.currentSecurePassword = password.trim(); // Store password after secure save
            }

            showSecureOpenModal() {
                this.secureOpenPassword.value = '';
                this.toggleSecureOpenPassword.checked = false;
                this.secureOpenPassword.type = 'password';
                this.secureOpenError.classList.add('hidden');
                this.secureOpenModal.classList.remove('hidden');
                this.secureOpenPassword.focus();
            }

            handleSecureOpen() {
                const password = this.secureOpenPassword.value.trim();
                const note = this.notes.find(n => n.id === this.currentNoteId);
                if (!note) return;

                try {
                    const decryptedContent = this.decryptNoteContent(note.content, password);
                    if (decryptedContent) {
                        this.noteContent.value = decryptedContent;
                        this.secureOpenModal.classList.add('hidden');
                        this.currentSecurePassword = password; // Store password after successful decryption
                    } else {
                        throw new Error('Decryption failed');
                    }
                } catch (e) {
                    this.secureOpenError.classList.remove('hidden');
                    this.secureOpenPassword.value = '';
                    console.error('Decryption error:', e);
                }
            }

            encryptNoteContent(content, password) {
                return CryptoJS.AES.encrypt(content, password.trim()).toString();
            }

            decryptNoteContent(content, password) {
                try {
                    const bytes = CryptoJS.AES.decrypt(content, password.trim());
                    const decryptedText = bytes.toString(CryptoJS.enc.Utf8);
                    if (decryptedText.length > 0) {
                        return decryptedText;
                    }
                    return null;
                } catch (e) {
                    return null;
                }
            }

            markAsEditing() {
                this.isEditing = true;
            }

            saveCurrentNote() {
                if (!this.currentNoteId) return;

                const note = this.notes.find(n => n.id === this.currentNoteId);
                if (!note) return;

                const title = this.noteTitle.value.trim() || 'Sem t√≠tulo';
                let content = this.noteContent.value;
                
                // New logic to handle secure notes
                if (note.isSecure) {
                    if (this.currentSecurePassword) {
                        content = this.encryptNoteContent(content, this.currentSecurePassword);
                    } else {
                        // If password is not in memory (page reload), just save with unencrypted content
                        // User will have to re-secure it. A better UI might handle this, but for now, this is a fail-safe.
                        console.warn('Cannot re-encrypt note, password not in memory. Saving unencrypted.');
                    }
                }
                
                note.title = title;
                note.content = content;
                note.updatedAt = new Date().toISOString();

                this.saveNotes();
                this.isEditing = false;
                this.render();
                
                this.showSaveIndicator();
            }

            showSaveIndicator() {
                const originalText = this.saveBtn.textContent;
                this.saveBtn.textContent = '‚úì Salvo';
                this.saveBtn.classList.add('bg-green-600');
                
                setTimeout(() => {
                    this.saveBtn.textContent = originalText;
                    this.saveBtn.classList.remove('bg-green-600');
                }, 1500);
            }

            showDeleteConfirmation(ids) {
                if (ids.length === 0) return;
                this.pendingDeleteIds = ids;
                
                if (ids.length > 1) {
                    this.confirmModalTitle.textContent = 'Confirmar exclus√£o em massa';
                    this.confirmModalText.textContent = `Tem certeza que deseja excluir as ${ids.length} anota√ß√µes selecionadas? Esta a√ß√£o n√£o pode ser desfeita.`;
                } else {
                    this.confirmModalTitle.textContent = 'Confirmar exclus√£o';
                    this.confirmModalText.textContent = 'Tem certeza que deseja excluir esta anota√ß√£o? Esta a√ß√£o n√£o pode ser desfeita.';
                }

                this.confirmModal.classList.remove('hidden');
            }

            hideDeleteConfirmation() {
                this.confirmModal.classList.add('hidden');
                this.pendingDeleteIds = null;
            }

            deleteNotes() {
                if (!this.pendingDeleteIds) return;

                this.notes = this.notes.filter(note => !this.pendingDeleteIds.includes(note.id));
                this.saveNotes();

                if (this.pendingDeleteIds.includes(this.currentNoteId)) {
                    this.currentNoteId = null;
                    this.hideEditor();
                }
                
                this.hideDeleteConfirmation();
                this.toggleBulkMode(false);
                this.render();
            }

            setAlignment(alignment, save = true) {
                const note = this.notes.find(n => n.id === this.currentNoteId);
                if (!note) return;
                
                // Remove previous alignment classes
                this.noteContent.classList.remove('text-left', 'text-center', 'text-right', 'text-justify');
                
                // Add new alignment class directly to the textarea
                this.noteContent.classList.add(`text-${alignment}`);

                if (save) {
                    note.alignment = alignment;
                    this.saveNotes();
                }
            }

            toggleBulkMode(forceState = null) {
                this.bulkMode = forceState !== null ? forceState : !this.bulkMode;
                document.body.classList.toggle('bulk-mode', this.bulkMode);
                
                this.selectedNotes.clear();
                this.updateSelectedCount();

                if (this.bulkMode) {
                    this.hideEditor();
                    this.bulkActionsBar.classList.remove('hidden');
                    this.bulkActionsBar.classList.add('flex');
                    this.bulkSelectBtn.textContent = 'Cancelar';
                } else {
                    this.bulkActionsBar.classList.add('hidden');
                    this.bulkActionsBar.classList.remove('flex');
                    this.bulkSelectBtn.textContent = 'Selecionar';
                    this.selectAllCheckbox.checked = false;
                }
                this.render();
            }

            toggleSelectAll() {
                const isChecked = this.selectAllCheckbox.checked;
                this.selectedNotes.clear();
                if (isChecked) {
                    this.notes.forEach(note => this.selectedNotes.add(note.id));
                }
                this.updateSelectedCount();
                this.render();
            }

            toggleNoteSelection(noteId) {
                const noteItem = document.querySelector(`.note-item[data-note-id="${noteId}"]`);
                if (this.selectedNotes.has(noteId)) {
                    this.selectedNotes.delete(noteId);
                } else {
                    this.selectedNotes.add(noteId);
                }
                noteItem.querySelector('input[type="checkbox"]').checked = this.selectedNotes.has(noteId);
                this.updateSelectedCount();

                // Update select all checkbox state
                this.selectAllCheckbox.checked = this.notes.length > 0 && this.selectedNotes.size === this.notes.length;
            }

            updateSelectedCount() {
                this.selectedCount.textContent = this.selectedNotes.size;
                this.deleteSelectedBtn.disabled = this.selectedNotes.size === 0;
            }

            showEditor() {
                this.emptyState.classList.add('hidden');
                this.editorHeader.classList.remove('hidden');
                this.noteContent.parentElement.classList.remove('hidden');
            }

            hideEditor() {
                this.emptyState.classList.remove('hidden');
                this.editorHeader.classList.add('hidden');
                this.noteContent.parentElement.classList.add('hidden');
            }

            updateActiveNote() {
                document.querySelectorAll('.note-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                if (this.currentNoteId && !this.bulkMode) {
                    const activeItem = document.querySelector(`[data-note-id="${this.currentNoteId}"]`);
                    if (activeItem) {
                        activeItem.classList.add('active');
                    }
                }
            }
            
            handleExport() {
                if (this.bulkMode && this.selectedNotes.size > 0) {
                    this.exportSelectedNotes();
                } else if (this.notes.length > 0) {
                    this.showExportSelectionModal();
                } else {
                    alert('N√£o h√° notas para exportar.');
                }
            }
            
            showExportSelectionModal() {
                this.exportNoteList.innerHTML = '';
                this.confirmExport.disabled = true;

                this.notes.forEach(note => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center space-x-2 p-3 border-b border-gray-200 dark:border-gray-700 last:border-b-0';
                    div.innerHTML = `
                        <input type="radio" name="exportNote" value="${note.id}" class="h-4 w-4 text-primary" id="radio-export-${note.id}">
                        <label for="radio-export-${note.id}" class="flex-1 cursor-pointer">
                            <h4 class="font-medium text-gray-800 dark:text-gray-200 truncate">${note.title}</h4>
                            <span class="text-xs text-gray-500 dark:text-gray-400">${this.formatDate(note.updatedAt)} ${note.isSecure ? 'üîí' : ''}</span>
                        </label>
                    `;
                    this.exportNoteList.appendChild(div);
                });

                this.exportNoteList.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', () => {
                        this.confirmExport.disabled = false;
                    });
                });
                
                this.exportSelectionModal.classList.remove('hidden');
            }

            exportSingleNoteFromModal() {
                const selectedRadio = this.exportNoteList.querySelector('input[name="exportNote"]:checked');
                if (selectedRadio) {
                    const noteId = selectedRadio.value;
                    const note = this.notes.find(n => n.id === noteId);
                    if (note) {
                        this.downloadFile([note]);
                        this.exportSelectionModal.classList.add('hidden');
                    }
                }
            }
            
            exportAllNotes() {
                this.downloadFile(this.notes);
                this.exportSelectionModal.classList.add('hidden');
            }

            exportSelectedNotes() {
                const notesToExport = this.notes.filter(note => this.selectedNotes.has(note.id));
                this.downloadFile(notesToExport);
                this.toggleBulkMode(false); // Exit bulk mode after export
            }
            
            downloadFile(notesArray) {
                const dataStr = JSON.stringify(notesArray, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const exportFileDefaultName = `notas-backup-${new Date().toISOString().split('T')[0]}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
            }

            importNotes(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedNotes = JSON.parse(e.target.result);
                        
                        if (Array.isArray(importedNotes)) {
                            const newNotes = importedNotes.map(note => ({
                                ...note,
                                id: this.generateId(),
                                importedAt: new Date().toISOString(),
                                // Ensure imported notes have alignment and secure status
                                alignment: note.alignment || 'left',
                                isSecure: note.isSecure || false
                            }));
                            
                            this.notes = [...newNotes, ...this.notes];
                            this.saveNotes();
                            this.render();
                            
                            this.showImportSuccess(newNotes.length);
                        } else {
                            this.showImportError('Formato de arquivo inv√°lido');
                        }
                    } catch (error) {
                        this.showImportError('Erro ao ler o arquivo JSON');
                    }
                };
                
                reader.readAsText(file);
                event.target.value = '';
            }

            showImportSuccess(count) {
                const originalText = this.exportBtn.textContent;
                this.exportBtn.textContent = `‚úì ${count} importadas`;
                this.exportBtn.classList.add('bg-green-600');
                
                setTimeout(() => {
                    this.exportBtn.textContent = originalText;
                    this.exportBtn.classList.remove('bg-green-600');
                }, 3000);
            }

            showImportError(message) {
                const originalText = this.exportBtn.textContent;
                this.exportBtn.textContent = '‚úó Erro';
                this.exportBtn.classList.add('bg-red-600');
                
                setTimeout(() => {
                    this.exportBtn.textContent = originalText;
                    this.exportBtn.classList.remove('bg-red-600');
                }, 3000);
                
                console.error('Import error:', message);
            }

            handleShare() {
                if (this.bulkMode && this.selectedNotes.size > 0) {
                    this.shareNotes(Array.from(this.selectedNotes));
                } else if (this.notes.length > 0) {
                    this.showShareSelectionModal();
                } else {
                    alert('N√£o h√° notas para compartilhar.');
                }
            }
            
            showShareSelectionModal() {
                this.shareNoteList.innerHTML = '';
                this.confirmShare.disabled = true;

                this.notes.forEach(note => {
                    const div = document.createElement('div');
                    div.className = 'flex items-center space-x-2 p-3 border-b border-gray-200 dark:border-gray-700 last:border-b-0';
                    div.innerHTML = `
                        <input type="radio" name="shareNote" value="${note.id}" class="h-4 w-4 text-primary" id="radio-share-${note.id}" ${note.isSecure ? 'disabled' : ''}>
                        <label for="radio-share-${note.id}" class="flex-1 cursor-pointer">
                            <h4 class="font-medium text-gray-800 dark:text-gray-200 truncate">${note.title}</h4>
                            <span class="text-xs text-gray-500 dark:text-gray-400">${this.formatDate(note.updatedAt)} ${note.isSecure ? 'üîí' : ''}</span>
                            ${note.isSecure ? '<span class="text-red-500 text-xs">(N√£o pode ser compartilhada)</span>' : ''}
                        </label>
                    `;
                    this.shareNoteList.appendChild(div);
                });

                this.shareNoteList.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.addEventListener('change', () => {
                        this.confirmShare.disabled = false;
                    });
                });
                
                this.shareModal.classList.remove('hidden');
            }

            shareSingleNoteFromModal() {
                const selectedRadio = this.shareNoteList.querySelector('input[name="shareNote"]:checked');
                if (selectedRadio) {
                    const noteId = selectedRadio.value;
                    this.shareNotes([noteId]);
                    this.shareModal.classList.add('hidden');
                }
            }

            shareAllNotes() {
                const notesToShare = this.notes.filter(note => !note.isSecure);
                this.shareNotes(notesToShare.map(note => note.id));
                this.shareModal.classList.add('hidden');
            }

            async shareNotes(noteIds) {
                const notesToShare = this.notes.filter(note => noteIds.includes(note.id));
                
                if (notesToShare.length === 0) {
                    alert('Nenhuma nota para compartilhar.');
                    return;
                }

                let shareText = '';
                let shareTitle = 'Minhas Anota√ß√µes';

                if (notesToShare.length === 1) {
                    shareTitle = notesToShare[0].title;
                    shareText = notesToShare[0].content;
                } else {
                    shareText = notesToShare.map(note => `--- ${note.title} ---\n${note.content}`).join('\n\n');
                }
                
                const shareData = {
                    title: shareTitle,
                    text: shareText
                };

                try {
                    if (navigator.share) {
                        await navigator.share(shareData);
                    } else {
                        throw new Error('Web Share API n√£o suportada.');
                    }
                } catch (error) {
                    console.error('Erro ao compartilhar:', error);
                    alert(`O compartilhamento falhou ou foi cancelado. Voc√™ pode copiar o texto abaixo:\n\n${shareText}`);
                }
                
                this.toggleBulkMode(false); // Exit bulk mode after share
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays <= 1) return 'Hoje';
                if (diffDays <= 2) return 'Ontem';
                if (diffDays <= 7) return `${diffDays - 1} dias atr√°s`;
                
                return date.toLocaleDateString('pt-BR');
            }

            render() {
                this.notesCount.textContent = `${this.notes.length} anota√ß${this.notes.length !== 1 ? '√µes' : '√£o'}`;
                this.bulkSelectBtn.style.display = this.notes.length > 0 ? 'block' : 'none';

                if (this.notes.length === 0) {
                    this.notesList.innerHTML = `
                        <div class="p-4 text-center text-gray-500 dark:text-gray-400">
                            <div class="text-3xl mb-2">üìù</div>
                            <p>Nenhuma anota√ß√£o ainda</p>
                        </div>
                    `;
                    this.hideEditor();
                } else {
                    this.notesList.innerHTML = this.notes.map(note => `
                        <div class="note-item p-4 border-b border-gray-200 dark:border-gray-700 transition-colors flex items-center gap-2 ${this.selectedNotes.has(note.id) ? 'active' : ''}" data-note-id="${note.id}">
                            ${this.bulkMode ? `<input type="checkbox" class="form-checkbox h-4 w-4 text-primary rounded note-checkbox" ${this.selectedNotes.has(note.id) ? 'checked' : ''} />` : ''}
                            <div class="note-content flex-1 ${this.bulkMode ? '' : 'cursor-pointer'}">
                                <h3 class="font-medium text-gray-800 dark:text-gray-200 truncate mb-2">${note.title} ${note.isSecure ? 'üîí' : ''}</h3>
                                <span class="text-xs text-gray-500 dark:text-gray-500">${this.formatDate(note.updatedAt)}</span>
                            </div>
                        </div>
                    `).join('');

                    document.querySelectorAll('.note-item').forEach(item => {
                        const noteId = item.getAttribute('data-note-id');
                        const noteContent = item.querySelector('.note-content');
                        
                        noteContent.addEventListener('click', () => {
                            if (!this.bulkMode) {
                                this.selectNote(noteId);
                            }
                        });

                        const checkbox = item.querySelector('.note-checkbox');
                        if (checkbox) {
                            checkbox.addEventListener('change', (e) => {
                                e.stopPropagation();
                                this.toggleNoteSelection(noteId);
                            });
                        }
                    });

                    this.updateActiveNote();
                    
                    if (!this.currentNoteId && this.notes.length > 0 && !this.bulkMode) {
                        this.hideEditor();
                    }
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            new NotesApp();
        });
    </script>
</body>
</html>
